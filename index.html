<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OnlineChess — Chessground Edition</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f1724; --accent:#60a5fa; --muted:#94a3b8; color-scheme: dark;
    }
    html,body{margin:0;height:100%;font-family:Inter,system-ui;background:#0b1220;color:#e6eef8}
    .app{max-width:1200px;margin:20px auto;padding:20px;display:grid;gap:20px;grid-template-columns:650px 1fr}
    .board-panel{background:#0f1724;border-radius:12px;padding:16px;box-shadow:0 6px 30px rgba(0,0,0,0.5)}
    #board{width:600px;height:600px;margin:auto;border-radius:12px;overflow:hidden}
    .side-panel{display:flex;flex-direction:column;gap:16px}
    .card{background:#0f1724;padding:14px;border-radius:12px}
    #moves{height:250px;overflow:auto}
    #chat{height:160px;overflow:auto;display:flex;flex-direction:column;gap:6px}
    textarea{background:#0b1220;border:1px solid #1e293b;color:#e6eef8;border-radius:8px;padding:8px;width:100%}
    button{background:#1e293b;color:#e6eef8;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.primary{background:var(--accent)}
  </style>
</head>
<body>
  <div class="app">
    <div class="board-panel">
      <h2>onlinechess.org — Chessground</h2>
      <div id="board"></div>
      <div style="margin-top:15px;display:flex;gap:10px;justify-content:center">
        <button id="newBtn" class="primary">New</button>
        <button id="undoBtn">Undo</button>
        <button id="flipBtn">Flip</button>
      </div>
    </div>

    <div class="side-panel">
      <div class="card">
        <h3>Moves</h3>
        <div id="moves"></div>
      </div>

      <div class="card">
        <h3>Chat</h3>
        <div id="chat"></div>
        <textarea id="chatInput" placeholder="Say something nice..."></textarea>
        <button id="sendChat">Send</button>
      </div>
    </div>
  </div>

  <!-- Chessground + Chess.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chessground@8.1.2/dist/chessground.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessground@8.1.2/assets/chessground.base.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessground@8.1.2/assets/themes/blue.css" />

  <script>
    const game = new Chess();
    let flipped = false;

    const ground = Chessground(document.getElementById('board'), {
      fen: game.fen(),
      orientation: 'white',
      draggable: {
        enabled: true,
        distance: 2,
      },
      movable: {
        free: false,
        color: 'white',
        dests: computeDests(),
        events: {
          after: onMove
        }
      },
      animation: { enabled: true, duration: 200 },
      highlight: { lastMove: true, check: true }
    });

    function computeDests(){
      const dests = new Map();
      game.SQUARES.forEach(s => {
        const moves = game.moves({square:s, verbose:true});
        if(moves.length) dests.set(s, moves.map(m=>m.to));
      });
      return dests;
    }

    function onMove(from, to){
      const move = game.move({from, to, promotion:'q'});
      if(!move) return;
      ground.set({fen:game.fen(), movable:{dests:computeDests(), color:game.turn()==='w'?'white':'black'}});
      addMove(move.san);
    }

    const movesDiv = document.getElementById('moves');
    function addMove(san){
      const p = document.createElement('div');
      p.textContent = san;
      movesDiv.appendChild(p);
      movesDiv.scrollTop = movesDiv.scrollHeight;
    }

    document.getElementById('newBtn').onclick = ()=>{
      game.reset();
      ground.set({fen:game.fen(), movable:{dests:computeDests(), color:'white'}});
      movesDiv.innerHTML='';
    };

    document.getElementById('undoBtn').onclick = ()=>{
      game.undo();
      ground.set({fen:game.fen(), movable:{dests:computeDests(), color:game.turn()==='w'?'white':'black'}});
    };

    document.getElementById('flipBtn').onclick = ()=>{
      flipped = !flipped;
      ground.set({orientation: flipped ? 'black' : 'white'});
    };

    // Chat
    const chat = document.getElementById('chat');
    const chatInput = document.getElementById('chatInput');
    document.getElementById('sendChat').onclick = ()=>{
      const t = chatInput.value.trim();
      if(!t) return;
      const d = document.createElement('div'); d.textContent = 'You: ' + t;
      chat.appendChild(d);
      chatInput.value='';
      chat.scrollTop = chat.scrollHeight;
    };
  </script>
</body>
</html>
